<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Management</title>
</head>
<body>
<h1>Student Management System</h1>

<div id="message"></div>

<h2>Add New Student</h2>
<form id="addForm">
    <label>Student ID:</label>
    <input type="text" name="student_id" required><br><br>

    <label>First Name:</label>
    <input type="text" name="name" required><br><br>

    <label>Last Name:</label>
    <input type="text" name="lastname" required><br><br>

    <label>Email:</label>
    <input type="email" name="email" required><br><br>

    <label>Password:</label>
    <input type="password" name="password" required><br><br>

    <label>Gender:</label>
    <select name="gender" required>
        <option value="">Select Gender</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
        <option value="Other">Other</option>
    </select><br><br>

    <button type="submit">Add Student</button>
</form>

<hr>

<h2>All Students</h2>
<button onclick="loadStudents()">Load Students</button>
<div id="studentsList"></div>

<hr>

<h2>Update Student</h2>
<label>MongoDB ID:</label>
<input type="text" id="updateId" placeholder="Enter student MongoDB ID">
<button onclick="loadStudent()">Load Student</button>

<form id="updateForm" style="display: none;">
    <label>Student ID:</label>
    <input type="text" name="student_id" required><br><br>

    <label>First Name:</label>
    <input type="text" name="name" required><br><br>

    <label>Last Name:</label>
    <input type="text" name="lastname" required><br><br>

    <label>Email:</label>
    <input type="email" name="email" required><br><br>

    <label>Password:</label>
    <input type="password" name="password" required><br><br>

    <label>Gender:</label>
    <select name="gender" required>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
        <option value="Other">Other</option>
    </select><br><br>

    <button type="submit">Update Student</button>
</form>

<hr>

<h2>Delete Student</h2>
<label>MongoDB ID:</label>
<input type="text" id="deleteId" placeholder="Enter student MongoDB ID">
<button onclick="deleteStudent()">Delete Student</button>

<script>
    const API_URL = 'http://localhost:3000';

    function showMessage(message, type) {
        const messageDiv = document.getElementById('message');
        messageDiv.innerHTML = `<p>${message}</p>`;
        setTimeout(() => messageDiv.innerHTML = '', 3000);
    }

    document.getElementById('addForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData);

        try {
            const response = await fetch(`${API_URL}/student`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const result = await response.json();
            if (response.ok) {
                showMessage('Student added successfully!');
                e.target.reset();
            } else {
                showMessage(`Error: ${result.error}`);
            }
        } catch (error) {
            showMessage(`Error: ${error.message}`);
        }
    });

    async function loadStudents() {
        try {
            const response = await fetch(`${API_URL}/student`);
            const students = await response.json();

            const container = document.getElementById('studentsList');
            if (students.length === 0) {
                container.innerHTML = '<p>No students found.</p>';
                return;
            }

            container.innerHTML = students.map(student => `
                    <div>
                        <strong>ID:</strong> ${student.student_id}<br>
                        <strong>Name:</strong> ${student.name} ${student.lastname}<br>
                        <strong>Email:</strong> ${student.email}<br>
                        <strong>Gender:</strong> ${student.gender}<br>
                        <strong>MongoDB ID:</strong> ${student._id}
                        <hr>
                    </div>
                `).join('');
        } catch (error) {
            showMessage(`Error: ${error.message}`);
        }
    }

    async function loadStudent() {
        const id = document.getElementById('updateId').value;
        if (!id) {
            showMessage('Please enter a student ID');
            return;
        }

        try {
            const response = await fetch(`${API_URL}/student/${id}`);
            const student = await response.json();

            if (response.ok) {
                const form = document.getElementById('updateForm');
                form.style.display = 'block';
                form.student_id.value = student.student_id;
                form.name.value = student.name;
                form.lastname.value = student.lastname;
                form.email.value = student.email;
                form.password.value = student.password;
                form.gender.value = student.gender;
                showMessage('Student loaded successfully!');
            } else {
                showMessage(`Error: ${student.error}`);
            }
        } catch (error) {
            showMessage(`Error: ${error.message}`);
        }
    }

    document.getElementById('updateForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const id = document.getElementById('updateId').value;
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData);

        try {
            const response = await fetch(`${API_URL}/student/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const result = await response.json();
            if (response.ok) {
                showMessage('Student updated successfully!');
                e.target.style.display = 'none';
                document.getElementById('updateId').value = '';
            } else {
                showMessage(`Error: ${result.error}`);
            }
        } catch (error) {
            showMessage(`Error: ${error.message}`);
        }
    });

    async function deleteStudent() {
        const id = document.getElementById('deleteId').value;
        if (!id) {
            showMessage('Please enter a student ID');
            return;
        }

        if (!confirm('Are you sure you want to delete this student?')) {
            return;
        }

        try {
            const response = await fetch(`${API_URL}/student/${id}`, {
                method: 'DELETE'
            });

            const result = await response.json();
            if (response.ok) {
                showMessage('Student deleted successfully!');
                document.getElementById('deleteId').value = '';
            } else {
                showMessage(`Error: ${result.error}`);
            }
        } catch (error) {
            showMessage(`Error: ${error.message}`);
        }
    }
</script>
</body>
</html>